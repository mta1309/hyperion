<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3.0//EN" "html.dtd">
<HTML>
<HEAD><TITLE>
Using CMake to Build Hercules Version 4.0</TITLE>
<LINK REL=STYLESHEET TYPE="text/css" HREF="../hercules.css">
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="icon" href="../images/favicon.ico" />
</HEAD>

<style>
li:not(:last-child) {
    margin-bottom: 5px;
}
    </style>

<BODY BGCOLOR="#ffffcc" TEXT="#000000" LINK="#0000A0"
      VLINK="#008040" ALINK="#000000">

<h1>Using CMake to Build Hercules Version 4.0</h1>
<hr />

<h2>Alphabetical List of CMake Hercules Build Command-Line Options</h2>
<p>
CMake command line options begin with the prefix <code>-D</code> and consist of the option name, 
an equals sign ("="), and an option value.  
</p>
    <p>
        These options are specific to building Hercules.&nbsp; Additional standard CMake options can also be used; a description of selected options may be found on <a href="cmakeopts.html">Standard CMake Build Options</a>.</p>
<p>Most options are yes/no options.
Yes/No options are case insensitive and may be written as 
Yes, Y, No, or N.
</p>
<p>
All CMake command line options may be set as environment values
by omitting the <code>-D</code> prefix.  
<code>-DHET-BZIP2=YES</code> on the CMake command line has the
same effect as setting the environment variable<code> HET-BZIP2</code>
to <code>YES</code>.
</p>
<p>A bold option value in the list below indicates a default option. 
Where no default is shown, 
the default is determined by the capabilities of the target system.
If the target supports the option, 
the default is yes, 
otherwise it is no.
</p>
<dl>

<dt><code>ADD-CFLAGS=&nbsp; "&lt;c-flags&gt;"</code></dt>
<dd>
<p>Provide additional c compiler command line options.  
Any string provided here is appended to the end of the c compiler flags generated by CMake, 
including optimization flags.  
This option allows you to specify additional optimization flags, such as <code>-O3</code>,
or to disable flags created by CMake.  
Flags added by <code>-DADD_CFLAGS=""</code> are shown in the summary of CMake build
options displayed at the end of CMake generation.  
</p>
<p>
If you need to add flags to the beginning of the c command line options list, 
for example include files or library directories, 
use the CMake option <nobr><code>-DCMAKE_C_FLAGS</code></nobr>.&nbsp;  
</p>
</dd>


<dt><code>AUTOMATIC-OPERATOR=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable the Hercules Automatic Operator feature.
Regular expression support is required on the target system, 
and the existence of the header file <code>regex.h</code> is used 
in the test for that support.  
</p>
<p>The Hercules Automatic Operator feature is described in more detail
<a href="../hercinst.html#HAO" target="_blank">here</a>.
</p>

<p>If the target system has regular expression support,
the default for this option is <code>YES</code>,
otherwise it is <code>NO</code>.
</p>
</dd>


<dt><code>CAPABILITIES=&nbsp; YES&nbsp; |&nbsp; <strong>NO</strong></code></dt>
<dd>
<p>Enable support for fine grained privileges for the HERCIFC utility.
Fine grained privileges allow HERCIFC to configure network interfaces for 
Channel-to-Channel operations without having root privileges.
</p>
<p>Fine grained privileges are not available on all systems.  
The existence of header file <code>sys/capability.h</code> and,
on targets that require it, <code>libcap</code> is tested
to determine if capabilities can be enabled.  
</p>
</dd>


<dt><code>CCKD-BZIP2=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable support for <code>bzip2</code> compression for emulated DASD.
</p>
<p>The <code>-bz2</code> command line option of the 
<code>dasdcopy</code>,
<code>dasdnint</code>, and 
<code>dasdload</code> 
utilities must be used to created an emulated DASD
file with <code>bzip2</code> compression.  
</p>
<p>If the target system has the header file <code>bzlib.h,</code>
and the <code>libbz</code> library, 
the default for this option is <code>YES</code>,
otherwise it is <code>NO</code>.
</p>
<p>
Note: zip2 compression support is enabled for emulated if the 
<code>libz</code> library is installed on the target system.  
There is no option to control the inclusion of zip2 compression
support for emulated DASD.
</p>
</dd>
    
    
<dt><code>CUSTOM=&nbsp; "&lt;descr&gt;"</code></dt>
<dd><p>Provide a custom description for this build.  
This description is included in the <code>config.h</code>
file generated by CMake and is in turn
displayed at Hercules startup in message HHC01417I.
</p>
<p>This option can be helpful if you build multiple copies of 
Hercules and wish to confirm the identity of the copy 
that is executed.  
</p>
</dd>
    
    
<dt><code>DEBUG=&nbsp; YES&nbsp; |&nbsp; <strong>NO</strong></code></dt>
<dd>
<p>Enable the Hercules debugging macros 
<code>TRACE</code>, 
<code>VERIFY</code>, and 
<code>ASSERT</code>
macros)
</p>
<p>This option may be useful for developers or if requested as part
of diagnosing an issue.  
It is not required for normal use of Hercules.  
</p>
</dd>
    
    
<dt><code>EXTERNAL-GUI=&nbsp; <strong>YES</strong>&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable the interface to an external graphical user interface.  
<a href="http://hercstudio.sourceforge.net/" target="_blank">Hercules Studio</a>
(open source systems and mac OS)
and
<a href="http://www.softdevlabs.com/hercgui.html" target="_blank">HercGUI</a>
(Windows) require this option.
</p>
<p><code>EXTERNAL-GUI=YES</code> is not required to use the Hercules internal web server.  
</p>
</dd>
    

<dt><code>EXTPKG_DIR=&lt;path&gt;</code></dt>
<dd>
<p><code>&lt;path&gt;</code> may be absolute or relative to the Hercules build directory.
</p>

<p>The <code>-DEXTPKG_DIR=&lt;path&gt;</code> option is most useful to Hercules developers who may have multiple
Hercules build directories, 
or who wish to erase and recreate the build
directory without rebuilding all external packages.
</p>

<p>This option specifies the path that the CMake build will use as the root of all
package directories for those external packages that CMake will build.
The external package directory structure looks like this:
</p>
<table style="margin-left: 40px">
    <tr>
        <td><code>extpkg/</code></td>
        <td>All external packages are placed in <code>extpkg/</code>,
            with a separate subdirectory per package
        </td>
    </tr>
    <tr>
        <td><code>extpkg/&lt;pkgname&gt;/</code></td>
        <td>directory for one external package, named "pkgname"</td>
    </tr>
    <tr>
        <td><code>extpkg/&lt;pkgname&gt;/pkgsrc</code></td>
        <td>source directory, generally from a git repository.</td>
    </tr>    
    <tr>
        <td><code>extpkg/&lt;pkgname&gt;/build</code></td>
        <td>build directory for an external package.</td>
    </tr>    
    <tr>
        <td><code>extpkg/&lt;pkgname&gt;/install</code></td>
        <td>install directory for the built package</td>
    </tr>    
</table>

<p>The default value for this directory is <code>&lt;build-dir&gt;/extpkg</code>, 
which causes CMake to build all external packages in the Hercules build directory
tree.  
This default enables a casual builder to build Hercules without
having to be aware of external packages at all.  
And should the casual builder tire of Hercules, 
deleting the build directory also deletes the
external package repositories, builds, and installation directories.
</p>
<p>Note:
<code>-DS3FH_DIR</code> and <code>-DEXTPKG_DIR</code> 
may both be specified for a given build.
If they are, then CMake will use the pre-built SoftFloat-3a For Hercules
and will build all other external packages (currently none) in the
directory specified by <code>-DEXTPKG_DIR</code>.  
The directory specified by <code>-DEXTPKG_DIR</code> will be created.
</p>
</dd>
<!--

---- The following option is for Windows only.  We shall expose and amplify this 
---- when Windows is a supported target for the CMake build.  

<dt><code>FTHREADS=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>(Windows Only) Use fish threads instead of posix threads
</p>
</dd>
-->
    
<dt><code>GETOPTWRAPPER=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Certain (older?) open source systems generate linker errors
when an executable uses <code>getopt()</code> and uses a shared library that 
also uses <code>getopt()</code>.  
</p>
<p>This option causes Hercules executables to call an internal routine in 
the shared library that in turn calls <code>getopt()</code>.
</p>
<p>
CMake does not (yet) test for the requirement to use a wrapper for <code>getopt()</code>.
If you receive linker error messages when building Hercules, 
please add this option and rebuild.  
Should this option address the linker error messages, 
please open an issue so CMake code can be developed 
and <em>tested</em>.
</p>
</dd>
    
    
<dt><code>HELP=&nbsp; YES&nbsp; |&nbsp; <strong>NO</strong></code></dt>
<dd>
<p>Display summary help for the CMake build and exit.  
Generator files needed to build Hercules are <em>not</em> created.
</p>
</dd>
    
    
<dt><code>HET-BZIP2=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable support for bzip2 compression for emulated tapes.  
</p>
<p>The <code>-b</code> command line option of the 
<code>hetupd</code>
utility must be used to convert an emulated tape
file to one with <code>bzip2</code> compression.  
No option exists in <code>hetinit</code> to create an emulated
tape file that uses <code>bzip2</code> compression.  
</p>
<p>
Note: zip2 compression support is enabled for emulated tapes if the 
<code>libz</code> library is installed on the target system.  
There is no option to control the inclusion of zip2 compression
support for emulated tapes in Hercules.  
</p>
</dd>
    
    
<dt><code>HQA_DIR=&nbsp; &lt;dirname&gt;</code></dt>
<dd><p>define dir containing optional header hqa.h
</p></dd>
    
    
<dt><code>INTERLOCKED-ACCESS-FACILITY-2=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd><p>Enable the Interlocked-Access Facility 2, as defined in the z/Architecture
Principles of Operation (SA22-7832-10, pages 1-16 and in the descriptions of each 
instruction affected by the presence of the Interlocked-Access Facility 2.
</p>
<p>Any of three target system and c compiler capabilities must be present to enable
the Interlocked-Access Facility 2.
In order of preference, they are:
</p>
<ol>
<li>C11-standard atomic intrinsic functions</li>
<li>__atomic built-in functions</li>
<li>__sync built-in functions</li>
</ol>
<p>If none of the above three capabilities exists in the target system,
Hercules will be built without the Interlocked-Access Facility 2 and 
without comment.  
</p>
<p>(??--is this what happens in autotools?  Yes, this is what happens
when autotools is used to build Hercules on a target system that does not support any
of the above capabilities.)
</p>
</dd>
    
    
<dt><code>IPV6=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd><p>Include IPV6 support in Hercules.
</p>
<p>If this option is not specified and the target system includes IPV6 support,
then Hercules will be built with IPV6 support.  
</p>
</dd>
    
    
<dt><code>LARGEFILE=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable support for large files (greater than 4GB) on those systems that 
do not natively support large files but have the capability to do so.
</p>
<p>Some systems support large files natively and do not require special
macros or coding to do so.  
Such systems include FreeBSD since version 2 (ca. 1994) and most (all?)
64-bit open source systems.
<p>The default is <code>LARGEFILE=YES</code> on target systems that offer
some form of large file support (native, specifically enabled, or transitional)
and <code>LARGEFILE=NO</code> on systems that have no large file support.  
</p>
<p><code>LARGEFILE=NO</code> is rejected for those systems that support 
large files natively; 
large file support cannot be disabled on such systems.  
</p>
<p>Large file support is required when using emulated 3390-9 or larger DASD,
when using DASD with very large shadow files, 
or when using emulated tape volumes that are much larger than 
would have been supported on the real hardware. 
</p>
<p>See the 
<a href="http://www.unix.org/version2/whatsnew/lfs20mar.html." target="_blank">
        document created by the Large File Summit</a> 
for details about how non-native large file support came to be a part of
The Single Unix Specification Version 2, in 1996.
</p>
</dd>
    
    
<dt><code>MULTI-CPU=&nbsp; YES&nbsp; |&nbsp; NO&nbsp; |&nbsp; &lt;number&gt</code></dt>
<dd><p>Specify the maximum number of CPUs that can be specified on the 
<code>numcpu</code> command.
</p>
<p><code>YES</code> generates support for a maximum of eight processors
(<code>numcpu 8</code>) and <code>NO</code> allows for only one processor.
Specifying <code>&lt;number&gt;</code> generates support for &lt;number&gt;
processors.  
The maximum value for &lt;number&gt; is 64 for 32-bit systems
and 128 for 64-bit (or greater?) systems
</p>
<p>If omitted, 
Hercules will be built to support 64 processors on 32-bit
<!-- or Windws-->
systems and 128 processors on 64-bit systems.  
</p>
<p>The existence of the type <code>__uint128_t</code> is used by the 
build to identify a 64-bit target;
without that type, 
the target system is assumed to be a 32-bit system. 
</p>
</dd>
    
    
<dt><code>OBJECT-REXX=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable support for Open Object Rexx support.  
</p>
<p>If this option is not specified and Open Object Rexx is installed,
Hercules is built with Open Object Rexx support.  
</p>
<p>If header files <code>rexx.h</code> and <code>oorexxapi.h</code>
are present, 
then Open Object is presumed to be installed.  
</p>
<p>It is perfectly reasonable to include support for both Open Object Rexx
and Regina Rexx in a single Hercules build.  . 
If both are installed on the targe system and neither has been excluded, 
then Hercules will be built with the capability to use either REXX language.
Hercules commands can be used to specify which REXX interpreter 
should be used at any given time.
</p>
</dd>
    
    
<dt><code>OPTIMIZATION=&nbsp; YES&nbsp; |&nbsp; NO&nbsp; |&nbsp; "&lt;flags&gt;"</code>
</td >
<dd>
<p>Enable automatic optimization, 
or specify c compiler optimization flags.
</p>
<p>Automatic optimization is possible only for c compilers
that the CMake build recognizes.
These include gcc and clang.  
</p>
<p>If you wish to build with a c compiler that the CMake build
for Hercules does not recognize,
you can use the <code>OPTIMIZE</code> and <code>ADD-CFLAGS</code>
options to specify compiler options.
</p>
</dd>
    
    
<dt><code>REGINA-REXX=&nbsp; YES&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>Enable support for Regina Rexx support.  
</p>
<p>If this option is not specified and Regina Rexx is installed,
Hercules is built to include Regina Rexx support.  
</p>
<p>If header file <code>rexxsaa.h</code>
is present, 
then Regina Rexx is presumed to be installed on the target system.  
</p>
<p>It is perfectly reasonable to include support for both Open Object Rexx
and Regina Rexx in a single Hercules build.&nbsp;
If both are installed on the targe system and neither has been excluded, 
then Hercules will be built with the capability to use either REXX language.
Hercules commands can be used to specify which REXX interpreter 
should be used at any given time.
</p>
</dd>
    
    
<dt><code>S3FH_DIR=&nbsp; &lt;dirname&gt;</code></dt>
<dd>
<p>Define the installation directory for SoftFloat-3a For Hercules, 
relative or absolute.
A relative directory is relative to the Hercules build directory.  
SoftFloat-3a For Hercules must have been previously built and 
installed to the directory specified by this option.  
</p>
<p>If <code>S3FH_DIR=</code> is coded, 
the CMake build does <em>not</em> clone and build SoftFloat-3a
For Hercules into the directory specified by <code>extpkg_dir</code>.&nbsp; 
If this option is omitted,
Hercules will clone and build a copy of SoftFloat-3a For Hercules
in the directory specified by or defaulted to by the 
<code>extpkg_dir</code> option.  
</p>
<p>This option is most useful for developers of SoftFloat-3a For
Hercules.
The option allows developers to incorporate draft changes to SoftFloat-3a
For Hercules into the Hercules build prior to those changes being 
committed to the SoftFloat-3a For Hercules repository.  
</p>
</dd>
    
    
<dt><code>SETUID-HERCIFC=&nbsp; YES&nbsp; |&nbsp; <strong>NO</strong></code></dt>
<dd><p>Install <code>hercifc</code> as setuid root.
</p>
<p>Note: <code>SETUID-HERCIFC=&lt;groupname&gt;</code> is not presently supported.
You must manually issue the command to set the group owner of <code>hercifc</code>.
</p>
</dd>
    
    
<dt><code>SYNCIO=&nbsp; <strong>YES</strong>&nbsp; |&nbsp; NO</code></dt>
<dd>
<p>The <code>SYNCIO</code> command line option enables or disables Syncio.&nbsp; 
Syncio refers to the processing of certain emulated I/O operations by the 
process thread that is emulating the CPU that executed the I/O instruction 
rather than dispatching an I/O thread.
</p>
<p>Syncio is deprecated and will be withdrawn from Hercules in the future, 
and all I/O operation emulation will be performed by an I/O thread.
</p>
<p>The default of <code>YES</code> will be changed in the near future.
To see whether there are any impacts on your use of Hercules, 
it is suggested that you define the environment variable
<code>SYNCIO=NO</code>.
</p>
</dd>
    
</table>
</dl>
<br /><hr />
<p>
<small>This web page Copyright &copy; 2017 by Stephen R. Orso.
<br /><br />
This work is licensed under the Creative Commons Attribution-
ShareAlike 4.0 International License. 
<br /><br />
To view a copy of this license,
visit 
<a href="http://creativecommons.org/licenses/by-sa/4.0/" 
        target="_blank">http://creativecommons.org/licenses/by-sa/4.0/</a> 
or send a letter to Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.

</small>
</p>

</BODY>

</HTML>